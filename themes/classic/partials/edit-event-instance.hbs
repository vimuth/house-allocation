<div class="panel panel-primary">
	<div class="panel-heading">
		<h3 id="nameTag" class="panel-title">{{eventInstance.name}}</h3>

		<div id="nameInput" style="display: none" class="form-group">
			<input type="text" class="form-control" id="eventName"
				placeholder="Enter Event Name" value="{{eventInstance.name}}"
				required>
		</div>

	</div>
	<div class="panel-body">

		<div class="row">
			<div class="col-md-7">
				<div style="display:" id="infoView">
					<h4>Description :</h4>
					<div id="desc">{{eventInstance.description}}</div>

					<table style="margin: 0px" class="table table-condensed">
						<!-- <thead>
					<tr>
						<th></th><th></th>
					</tr>
					</thead> -->
						<tbody>
							<tr style="margin: 0px; padding: 0px">
								<td style="margin: 0px; padding: 0px; border: none">
									<h4>From</h4>
								</td>
								<td style="border: none" id="sDate">{{eventInstance.startDate}}</td>
							</tr>
							<tr style="margin: 0px; padding: 0px">
								<td style="margin: 0px; padding: 0px; border: none">
									<h4>To</h4>
								</td>
								<td style="border: none" id="eDate">{{eventInstance.endDate}}</td>
							</tr>
						</tbody>
					</table>
				</div>
				<div id="infoInput" style="display: none">
					<form id="myform" name="newEvent">

						<div class="form-group">
							<label for="eventDescriptionInput">Description</label>
							<textarea class="form-control" id="eventDescriptionInput"
								rows="3">{{eventInstance.description}}</textarea>
						</div>

						<div id="nameInput" class="form-group">
							<label for="sdatepicker">Start Date</label> <input type="text"
								class="dateInput form-control" id="sdatepicker"
								value={{eventInstance.startDate}} />
						</div>

						<div id="nameInput" class="form-group">
							<label for="edatepicker">Start Date</label> <input type="text"
								class="dateInput form-control" id="edatepicker"
								value={{eventInstance.endDate}} />
						</div>
					</form>

				</div>
				<div>
					<button class="btn btn-warning btn-xs pull-right"
						onclick="editEvent($(this))">Edit Basic Info</button>
				</div>
			</div>

			<div class="col-md-5">
				<div class="panel">
					<div class="panel-heading">
						<h3 class="panel-title">
							Results {{#if isAdmin}} <span>
								<button class="btn btn-warning btn-xs pull-right"
									onclick="setRank($(this))">Set Results</button>
							</span> {{/if}}
						</h3>
					</div>
					<div id="rankPanel" style="display:" class="panel-body">
						<table class="table table-condensed">

							{{#each ranks}}
							<tr>

								<td><h2>{{rank}}</h2></td>
								<td><img
									src="/TestApp2/themes/classic/images/Cliub Logos-0{{house_id}}.jpg"
									alt="Smiley face" height="80" width="80"></td>

							</tr>
							{{/each}}

						</table>
					</div>
					{{#if isAdmin}}
					<div id="rankInputForm" style="display: none" class="panel-body">

						<ul class="list-group">
							<li class="list-group-item">
								<div class="row">
									<div class="center-block col-md-7">CloudBots :</div>
									<div class="col-md-5">
										<input name="1" type="text" class="Rank form-control"
											id="Rank" placeholder="Rank">
									</div>
								</div>
							</li>
							<li class="list-group-item">
								<div class="row">
									<div class="center-block col-md-7">Legion :</div>
									<div class="col-md-5">
										<input name="2" type="text" class="Rank form-control"
											id="Rank" placeholder="Rank">
									</div>
								</div>
							</li>
							<li class="list-group-item">
								<div class="row">
									<div class="center-block col-md-7">Titans :</div>
									<div class="col-md-5">
										<input name="3" type="text" class="Rank form-control"
											id="Rank" placeholder="Rank">
									</div>
								</div>
							</li>
							<li class="list-group-item">
								<div class="row">
									<div class="center-block col-md-7">WildBoars :</div>
									<div class="col-md-5">
										<input name="4" type="text" class="Rank form-control"
											id="Rank" placeholder="Rank">
									</div>
								</div>
							</li>

						</ul>

					</div>
					{{/if}}

				</div>


			</div>
		</div>

		<h4 class="panel">Activities :</h4>

		<ul class="list-group">
			{{#each activities}}

			<li class="list-group-item">
				<div class="row">

					<div class="col-md-7">
						<h4 class="list-group-item-heading">{{name}}</h4>
						<div style="display:" id="actInfoDisplay">
							<p id='description'>{{description}}</p>
							<p id='venue'>At : {{venue}}</p>
							<p id='datetime'>On : {{datetime}}</p>
						</div>
						<form style="display: none" id="actInfoForm" name="actInfoForm">
							<div class="form-group">
								<label for="actDescription">Description</label>
								<textarea class="form-control" id="actDesc" rows="3">{{description}}</textarea>
							</div>
							<div class="form-group">
								<label for="actVenue">Venue</label> <input type="text"
									class="form-control" id="actVenue" value="{{venue}}" required>
							</div>
							<div class="form-group">
								<label for="inputDate">Date/Time : </label>
								<div class='input-group date' id='inputDate'>
									<input type='text' class="form-control" id='actDateInput'
										data-format="YYYY-MM-DD HH:mm" value="{{datetime}}" /> <span
										class="input-group-addon"><span
										class="glyphicon glyphicon-calendar"></span> </span>
								</div>
							</div>
						</form>


					</div>
					<div class="col-md-5">

						{{#unless winner}} <span class="label label-default pull-right">
							{{#if_eq type "G"}}Group{{/if_eq}} {{#if_eq type
							"I"}}Individual{{/if_eq}} </span> {{/unless}} {{#if winner}}
						<h4>Results :</h4>
						<table style="margin: 0px" class="table table-condensed">
							{{#each winner}}
							<tr>
								<td style="border: none"><h5>{{rank}} :
										{{description}}</h5></td>

								<td style="border: none">{{#if_eq ../type "I"}}
									<h5>{{winner}}</h5> {{/if_eq}} {{#if_eq ../type "G"}} <img
									class="pull-right"
									src="/TestApp2/themes/classic/images/Cliub Logos-0{{winner}}.jpg"
									alt="Smiley face" height="40" width="40"> {{/if_eq}}
								</td>
							</tr>
							{{/each}}
						</table>
						{{/if}}


					</div>
				</div> {{#if ../isAdmin}}
				<div class="row">
					<div class="btn-group" style="margin-left: 10px">
						<button type="button" onclick='editActivity($(this),"{{id}}")'
							class="btn btn-warning btn-xs">Edit</button>
						<button type="button" onclick='deleteActivity($(this),"{{id}}")'
							class="btn btn-danger btn-xs">Delete</button>
					</div>
				</div> {{/if}}
			</li> {{/each}}
		</ul>

		<h4 class="panel">Awards :</h4>

		<ul class="list-group">
			{{#each awards}}
			<li class="list-group-item">
				<div class="row">

					<div class="col-md-8">
						<h4 class="list-group-item-heading">{{name}}</h4>

						<div style="display:" id="awdInfoDisplay">
							<p id='description'>{{description}}</p>
							{{#if_eq isVote "true"}}{{#unless winner}}
							<p id='voteEnd'>Voting Ends On :{{vote_endDate}}</p>
							{{/unless}}{{/if_eq}}
						</div>

						<form style="display: none"
							onsubmit='submitEditedAward($(this),"{{id}}","{{isVote}}");return false;'
							id="awdInfoForm" name="awdInfoForm">
							<div class="form-group">
								<label for="awdDescription">Description</label>
								<textarea class="form-control" id="awdDescription" rows="3">{{description}}</textarea>
							</div>
							<div class="form-group">

								<label for="inputDate">Voting start on : </label>
								<div class='input-group date' id='inputDate'>
									<input type='text' class="form-control"
										id='awdVoteStartDateInput' data-format="YYYY-MM-DD HH:mm"
										value="{{vote_startDate}}" /> <span class="input-group-addon"><span
										class="glyphicon glyphicon-calendar"></span> </span>
								</div>
							</div>
							<div class="form-group">
								<label for="inputDate">Voting ends on : </label>
								<div class='input-group date' id='inputDate'>
									<input type='text' class="form-control"
										id='awdVoteEndDateInput' data-format="YYYY-MM-DD HH:mm"
										value="{{vote_endDate}}" /> <span class="input-group-addon"><span
										class="glyphicon glyphicon-calendar"></span> </span>
								</div>
							</div>

							<button type="submit" class="btn btn-success btn-xs">Submit</button>
							<button onclick='cancelEditAward($(this,"{{id}}"));return false;'
								class="btn btn-warning btn-xs">Cancel</button>
						</form>

					</div>
					<div class="col-md-4">
						{{#unless winner}} <span class="label label-default pull-right">{{#if_eq
							type "G"}}Group{{/if_eq}}{{#if_eq type "I"}}Individual{{/if_eq}}</span>
						<span class="label label-primary pull-right" id="voteLabel">{{#if_eq
							isVote "true"}}Vote{{/if_eq}}</span> {{/unless}} {{#if winner}}
						<table style="margin: 0px" class="table">

							{{#each winner}}
							<tr style="border-width: 0px; padding: 0px">
								<td style="border: none">{{#if_eq ../type "I"}}{{name}}
									{{/if_eq}} {{#if_eq ../type "G"}} <img
									src="/TestApp2/themes/classic/images/Cliub Logos-0{{name}}.jpg"
									height="60" width="60" /> {{/if_eq}}
								</td>
							</tr>
							{{/each}}
						</table>
						{{/if}}
					</div>
				</div> {{#if ../isAdmin}}
				<div style="display:" id="awdAdminButtons" class="row">
					<div class="btn-group" style="margin-left: 10px">
						<button type="button"
							onclick="editAward($(this),{{id}},{{isVote}})"
							class="btn btn-warning btn-xs">Edit</button>
						<button type="button" onclick="deleteAward($(this),{{id}})"
							class="btn btn-danger btn-xs">Delete</button>
					</div>
				</div> {{/if}}
			</li> {{/each}}
		</ul>
	</div>
</div>


<script>
	$(document).ready(

	/* This is the function that will get executed after the DOM is fully loaded */
	function() {
		$('#inputDate').datetimepicker();
	}

	);

	/* this function is used to set the event ranking */
	function setRank(button) {
		$('#rankPanel').css('display', 'none');
		$('#rankInputForm').css('display', '');

		button
				.parent()
				.html(
						'<button class="btn btn-success btn-xs pull-right"	onclick="submitRank($(this))">Submit</button><button class="btn btn-warning btn-xs pull-right"	onclick="cancelRanking($(this))">Cancel</button>')
	}

	function cancelRanking(button) {
		$('#rankPanel').css('display', '');
		$('#rankInputForm').css('display', 'none');

		button
				.parent()
				.html(
						'<button class="btn btn-warning btn-xs pull-right"	onclick="setRank($(this))">Set Results</button>')
	}

	function submitRank(button) {
		var ranks = [];

		$('.Rank').each(function() {
			if ($(this).val().match(/^\d+$/)) {
				ranks.push({
					'house_id' : $(this).attr('name'),
					'rank' : $(this).val()
				});
			}
		});

		$.ajax({
			type : "POST",
			contentType : "application/json",
			url : '{{url "/edit-event-instance/"}}' + '?operation=setRank',
			data : JSON.stringify({
				'eventId' : '{{eventInstance.id}}',
				'rankings' : ranks
			}),
			success : function(msg) {
				if (msg.redirect) {
					window.location = msg.url;
				}
				;
				location.reload();
			}
		});

	}

	function editEvent(button) {

		$('#nameTag').css('display', 'none');
		$('#nameInput').css('display', '');
		$('#infoView').css('display', 'none');
		$('#infoInput').css('display', '');

		button
				.parent()
				.html(
						'<button class="btn btn-success btn-xs pull-right" onclick="submitInfo($(this))">Submit</button><button class="btn btn-warning btn-xs pull-right" onclick="cancelEditEvent($(this))">cancel</button>')
	}

	function cancelEditEvent(button) {

		$('#nameTag').css('display', '');
		$('#nameInput').css('display', 'none');
		$('#infoView').css('display', '');
		$('#infoInput').css('display', 'none');

		button
				.parent()
				.html(
						'<button class="btn btn-warning btn-xs pull-right" onclick="editEvent($(this))">Edit Basic Info</button>')
	}

	function submitInfo(button) {
		$.ajax({
			type : "POST",
			contentType : "application/json",
			url : '{{url "/edit-event-instance/"}}' + '?operation=updateInfo',
			data : JSON.stringify({
				'id' : '{{eventInstance.id}}',
				'name' : $('#eventName').val(),
				'description' : $('#eventDescriptionInput').val(),
				'startDate' : $('#sdatepicker').val(),
				'endDate' : $('#edatepicker').val(),
			}),
			success : function(msg) {
				if (msg.success) {

					$('#nameTag').html($('#eventName').val());
					$('#desc').html($('#eventDescriptionInput').val());
					$('#sDate').html($('#sdatepicker').val());
					$('#eDate').html($('#edatepicker').val());

				} else {
					alert("Error");
				}
			}
		});
		cancelEditEvent(button);
	}
	
	function deleteActivity(button,id){
		
		if(confirm("Are you sure you want to delete this Activity")){
			$.ajax({
				type : "POST",
				contentType : "application/json",
				url : '{{url "/edit-event-instance/"}}' + '?operation=deleteActivity',
				data : JSON.stringify({ 'id':id
				}),
				success : function(msg) {
					if (msg.success) {
						button.parent().parent().parent().remove()

					} else {
						alert("Error");
					}
				}
			});
			return;
		}
		
	}
	function deleteAward(button,id){
		
		if(confirm("Are you sure you want to delete this Award")){
			$.ajax({
				type : "POST",
				contentType : "application/json",
				url : '{{url "/edit-event-instance/"}}' + '?operation=deleteAward',
				data : JSON.stringify({ 'id':id
				}),
				success : function(msg) {
					if (msg.success) {
						button.parent().parent().parent().remove()

					} else {
						alert("Error");
					}
				}
			});
			return;
		}
		
	}
	
	function editActivity(button,id){
		
		button.parent().parent().parent().find('#actInfoDisplay').css('display', 'none');
		
		button.parent().parent().parent().find('#actInfoForm').css('display', '');
		
		button.parent().html('<button type="button" onclick="submitEditedActivity($(this),\''+id+'\')" class="btn btn-success btn-xs">Submit</button><button type="button" onclick="cancelEditActivity($(this),\''+id+'\')" class="btn btn-warning btn-xs">Cancel</button>');
	
	}
	
	function cancelEditActivity(button,id){
		button.parent().parent().parent().find('#actInfoDisplay').css('display', '');
		
		button.parent().parent().parent().find('#actInfoForm').css('display', 'none');
		
		button.parent().html('<button type="button" onclick="editActivity($(this),\''+id+'\')" class="btn btn-warning btn-xs">Edit</button><button type="button" onclick="deleteActivity($(this),\''+id+'\')" class="btn btn-danger btn-xs">Delete</button>');
	}
	
	
	function submitEditedActivity(button, id){
		var description = button.parent().parent().parent().find('#actDesc').val();
		var venue = button.parent().parent().parent().find('#actVenue').val();
		var date =  moment(button.parent().parent().parent().find('#actDateInput').val());
		
		$.ajax({
			type : "POST",
			contentType : "application/json",
			url : '{{url "/edit-event-instance/"}}' + '?operation=updateActivity',
			data : JSON.stringify({
				'id' : id,
				'description' : description,
				'datetime' : date.format('YYYY-MM-DD HH:mm'),
				'venue' : venue,
			}),
			success : function(msg) {
				if (msg.success) {

					button.parent().parent().parent().find('#description').html(description);
					button.parent().parent().parent().find('#venue').html("At : "+venue);
					button.parent().parent().parent().find('#datetime').html("On : "+date.toString());
					
					cancelEditActivity(button,id);

				} else {
					alert("Error");
				}
			}
		});
		
	}
	
	function editAward(button,id,isVote){
		button.parent().parent().parent().find('#awdInfoDisplay').css('display', 'none');
		button.parent().parent().parent().find('#awdInfoForm').css('display', '');
		button.parent().parent().css('display', 'none');
	}
	
	function cancelEditAward(button,id){
		button.parent().parent().find('#awdInfoDisplay').css('display', '');
		button.parent().parent().find('#awdInfoForm').css('display', 'none');
		button.parent().parent().parent().parent().find('#awdAdminButtons').css('display', '');
		
	}
	
	
	function submitEditedAward(form, id,isVote){
		
		if(isVote){
			var description = form.find('#awdDescription').val();
			var startDate = form.find('#awdVoteStartDateInput').val();
			var endDate = form.find('#awdVoteEndDateInput').val();
			alert(description);
		}
		else{
			
		}
		/*var description = button.parent().parent().parent().find('#actDesc').val();
		var venue = button.parent().parent().parent().find('#actVenue').val();
		var date =  moment(button.parent().parent().parent().find('#actDateInput').val());
		
		$.ajax({
			type : "POST",
			contentType : "application/json",
			url : '{{url "/edit-event-instance/"}}' + '?operation=updateActivity',
			data : JSON.stringify({
				'id' : id,
				'description' : description,
				'datetime' : date.format('YYYY-MM-DD HH:mm'),
				'venue' : venue,
			}),
			success : function(msg) {
				if (msg.success) {

					button.parent().parent().parent().find('#description').html(description);
					button.parent().parent().parent().find('#venue').html("At : "+venue);
					button.parent().parent().parent().find('#datetime').html("On : "+date.toString());
					
					cancelEditAward(button,id);

				} else {
					alert("Error");
				}
			}
		}); */
		
	}
</script>